---
layout: post
title: "GraphQL Subscriptionsë¥¼ í™œìš©í•œ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì‹¤ì‹œê°„ ê²Œì„ ì„œë²„ êµ¬ì¶•í•˜ê¸°"
description: " "
date: 2023-11-10
tags: [graphql, javascript]
comments: true
share: true
---

## ì„œë¡ 
ì‹¤ì‹œê°„ ê²Œì„ ì„œë²„ë¥¼ êµ¬ì¶•í•  ë•ŒëŠ” ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ GraphQL Subscriptionsë¥¼ ì‚¬ìš©í•˜ì—¬ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‹¤ì‹œê°„ ê²Œì„ ì„œë²„ë¥¼ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

## GraphQL Subscriptionsë€?
GraphQL SubscriptionsëŠ” GraphQLì˜ ì¼ë¶€ì¸ë°, ì´ë¥¼ ì‚¬ìš©í•˜ë©´ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ ë°ì´í„°ë¥¼ êµ¬ë…í•˜ê³  ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì›¹ì†Œì¼“ í”„ë¡œí† ì½œì„ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•˜ë©°, ì„œë²„ì—ì„œ ë°ì´í„°ì˜ ë³€ê²½ì´ ë°œìƒí•  ë•Œë§ˆë‹¤ í´ë¼ì´ì–¸íŠ¸ì— ì‹¤ì‹œê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸ëœ ë°ì´í„°ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì‹¤ì‹œê°„ ê²Œì„ ì„œë²„ êµ¬ì¶•í•˜ê¸°
1. Node.jsì™€ Expressë¥¼ ì‚¬ìš©í•˜ì—¬ GraphQL ì„œë²„ë¥¼ êµ¬ì¶•í•©ë‹ˆë‹¤.
2. Apollo Serverë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.
```javascript
npm install apollo-server
```
3. GraphQL ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•©ë‹ˆë‹¤. 
```javascript
const typeDefs = `
  type Game {
    id: ID!
    name: String!
    score: Int!
  }
  
  type Query {
    game(id: ID!): Game
    games: [Game]
  }
  
  type Mutation {
    createGame(name: String!, score: Int!): Game
    updateScore(id: ID!, score: Int!): Game
  }
  
  type Subscription {
    gameUpdated: Game
  }
`;
```
4. resolversë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
```javascript
const resolvers = {
  Query: {
    game: (parent, { id }) => {
      // ê²Œì„ ì •ë³´ ë°˜í™˜ ë¡œì§ êµ¬í˜„
    },
    games: () => {
      // ê²Œì„ ëª©ë¡ ë°˜í™˜ ë¡œì§ êµ¬í˜„
    },
  },
  Mutation: {
    createGame: (parent, { name, score }) => {
      // ê²Œì„ ìƒì„± ë¡œì§ êµ¬í˜„
    },
    updateScore: (parent, { id, score }) => {
      // ì ìˆ˜ ì—…ë°ì´íŠ¸ ë¡œì§ êµ¬í˜„
    },
  },
  Subscription: {
    gameUpdated: {
      resolve: (parent) => {
        return parent;
      },
      subscribe: () => pubsub.asyncIterator('GAME_UPDATED'),
    },
  },
};
```
5. Apollo Serverë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.
```javascript
import { ApolloServer } from 'apollo-server-express';

const server = new ApolloServer({
  typeDefs,
  resolvers,
});

server.applyMiddleware({ app });
httpServer.listen(4000, () => {
  console.log(`ğŸš€ Server ready at http://localhost:4000${server.graphqlPath}`)
});
```
6. í´ë¼ì´ì–¸íŠ¸ì—ì„œ GraphQL Subscriptionsë¥¼ êµ¬ë…í•˜ê³  ì—…ë°ì´íŠ¸ëœ ë°ì´í„°ë¥¼ ë°›ì•„ì˜µë‹ˆë‹¤.
```javascript
import { ApolloClient, InMemoryCache, gql } from '@apollo/client';
import { SubscriptionClient } from 'subscriptions-transport-ws';
import { WebSocketLink } from '@apollo/client/link/ws';

const subscriptionClient = new SubscriptionClient('ws://localhost:4000/graphql', {
  reconnect: true,
});

const wsLink = new WebSocketLink(subscriptionClient);

const client = new ApolloClient({
  link: wsLink,
  cache: new InMemoryCache(),
});

client.subscribe({
  query: gql`
    subscription {
      gameUpdated {
        id
        name
        score
      }
    }
  `,
}).subscribe({
  next(data) {
    console.log(data);
    // ì—…ë°ì´íŠ¸ëœ ê²Œì„ ë°ì´í„° ì²˜ë¦¬ ë¡œì§ êµ¬í˜„
  },
  error(error) {
    console.error(error);
  },
});
```

## ë§ˆë¬´ë¦¬
GraphQL Subscriptionsë¥¼ ì‚¬ìš©í•˜ì—¬ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‹¤ì‹œê°„ ê²Œì„ ì„œë²„ë¥¼ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê²Œì„ ì„œë²„ì—ì„œ ë°œìƒí•˜ëŠ” ë°ì´í„°ì˜ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ê°„í¸í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#graphql #javascript