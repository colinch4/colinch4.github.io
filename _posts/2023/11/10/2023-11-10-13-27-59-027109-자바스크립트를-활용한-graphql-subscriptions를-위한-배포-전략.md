---
layout: post
title: "μλ°”μ¤ν¬λ¦½νΈλ¥Ό ν™μ©ν• GraphQL Subscriptionsλ¥Ό μ„ν• λ°°ν¬ μ „λµ"
description: " "
date: 2023-11-10
tags: [GraphQL, Subscriptions]
comments: true
share: true
---

GraphQLμ€ API κ°λ°μ„ μ„ν• κ°•λ ¥ν• λ„κµ¬μ΄λ©°, Subscriptionsλ¥Ό ν†µν•΄ μ‹¤μ‹κ°„ λ°μ΄ν„° ν‘Έμ‹λ¥Ό κµ¬ν„ν•λ” κ²ƒλ„ κ°€λ¥ν•©λ‹λ‹¤. μ—¬κΈ°μ„λ” μλ°”μ¤ν¬λ¦½νΈλ¥Ό ν™μ©ν•μ—¬ GraphQL Subscriptionsλ¥Ό κ°λ°ν•κ³  λ°°ν¬ν•λ” μ „λµμ— λ€ν•΄ μ•μ•„λ³΄κ² μµλ‹λ‹¤.

## 1. ν™κ²½ μ„¤μ •

μ²« λ²μ§Έ λ‹¨κ³„λ΅, GraphQL Subscriptionsλ¥Ό κ°λ°ν•κ³  λ°°ν¬ν•κΈ° μ„ν•΄ μ„λ²„ ν™κ²½μ„ μ„¤μ •ν•΄μ•Ό ν•©λ‹λ‹¤. μ΄λ¥Ό μ„ν•΄ Node.jsμ™€ Express.jsλ¥Ό μ‚¬μ©ν•μ—¬ GraphQL μ„λ²„λ¥Ό κµ¬μ„±ν•©λ‹λ‹¤. npmμ„ ν†µν•΄ ν•„μ”ν• λΌμ΄λΈλ¬λ¦¬λ¥Ό μ„¤μΉν•κ³ , μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈμ— ν•„μ”ν• μμ΅΄μ„±μ„ κ΄€λ¦¬ν•©λ‹λ‹¤.

```javascript
const express = require('express');
const { ApolloServer, PubSub } = require('apollo-server-express');
// ν•„μ”ν• λΌμ΄λΈλ¬λ¦¬λ¥Ό import ν•©λ‹λ‹¤.

const app = express();
const pubsub = new PubSub();

const typeDefs = `
  type Subscription {
    messageSent: String!
  }
`;

const resolvers = {
  Subscription: {
    messageSent: {
      subscribe: () => pubsub.asyncIterator(['MESSAGE_SENT']),
    },
  },
};

const server = new ApolloServer({ typeDefs, resolvers });

server.applyMiddleware({ app });

app.listen({ port: 4000 }, () =>
  console.log(`π€ Server ready at http://localhost:4000${server.graphqlPath}`),
);
```

## 2. μ‹¤μ‹κ°„ λ°μ΄ν„° ν‘Έμ‹

λ‘ λ²μ§Έ λ‹¨κ³„λ” GraphQL Subscriptionsλ¥Ό μ‚¬μ©ν•μ—¬ μ‹¤μ‹κ°„ λ°μ΄ν„° ν‘Έμ‹λ¥Ό κµ¬ν„ν•λ” κ²ƒμ…λ‹λ‹¤. pubsub κ°μ²΄λ¥Ό μ‚¬μ©ν•μ—¬ λ©”μ‹μ§€λ¥Ό λ°ν–‰ν•κ³ , μ΄λ¥Ό κµ¬λ…ν•λ” ν΄λΌμ΄μ–ΈνΈμ—κ² λ°μ΄ν„°λ¥Ό μ „λ‹¬ν•©λ‹λ‹¤.

```javascript
// ...

const MESSAGE_SENT = 'MESSAGE_SENT';

const resolvers = {
  Mutation: {
    sendMessage: (_, { message }) => {
      pubsub.publish(MESSAGE_SENT, { messageSent: message });
      return true;
    },
  },
  Subscription: {
    messageSent: {
      subscribe: () => pubsub.asyncIterator([MESSAGE_SENT]),
    },
  },
};

// ...
```

μ„μ μμ μ—μ„λ” `sendMessage` λ®¤ν…μ΄μ…μ„ ν†µν•΄ λ©”μ‹μ§€λ¥Ό λ°ν–‰ν•κ³ , `messageSent` κµ¬λ…μ„ ν†µν•΄ ν΄λΌμ΄μ–ΈνΈμ—κ² μ „λ‹¬ν•©λ‹λ‹¤.

## 3. λ°°ν¬ μ „λµ

λ§μ§€λ§‰μΌλ΅, μλ°”μ¤ν¬λ¦½νΈλ΅ κ°λ°ν• GraphQL Subscriptionsλ¥Ό λ°°ν¬ν•λ” μ „λµμ— λ€ν•΄ μ•μ•„λ³΄κ² μµλ‹λ‹¤. μ—¬λ¬ μµμ…μ΄ μμ§€λ§, μ•„λμ μ „λµμ„ λ”°λ¥Ό μ μμµλ‹λ‹¤.

### 3.1. μ„λ²„ νΈμ¤ν…

GraphQL Subscriptionsλ” μ„λ²„κ°€ μ•΅ν‹°λΈ μƒνƒλ¥Ό μ μ§€ν•΄μ•Ό ν•λ―€λ΅, νΈμ¤ν… μ„λΉ„μ¤λ¥Ό μ‚¬μ©ν•μ—¬ μ„λ²„λ¥Ό λ°°ν¬ν•©λ‹λ‹¤. Heroku, AWS, Azure λ“±μ ν΄λΌμ°λ“ νΈμ¤ν… μ„λΉ„μ¤λ¥Ό κ³ λ ¤ν•  μ μμµλ‹λ‹¤. μ„λ²„ λ°°ν¬ μ‹μ—λ” μ„λ²„ μ„¤μ •, λ„λ©”μΈ μ—°κ²°, SSL μΈμ¦μ„ λ“±μ„ κ³ λ ¤ν•΄μ•Ό ν•©λ‹λ‹¤.

### 3.2. ν΄λΌμ΄μ–ΈνΈ κ°λ°

ν΄λΌμ΄μ–ΈνΈ κ°λ° μ‹, Apollo Clientμ™€ κ°™μ€ GraphQL ν΄λΌμ΄μ–ΈνΈ λΌμ΄λΈλ¬λ¦¬λ¥Ό μ‚¬μ©ν•μ—¬ GraphQL Subscriptionsλ¥Ό κµ¬λ…ν•  μ μμµλ‹λ‹¤. ν΄λΌμ΄μ–ΈνΈμ—μ„ μ†μΌ“ μ—°κ²°μ„ μ μ§€ν•κ³ , κµ¬λ…μ„ μ„ν•΄ `subscribe` ν•¨μλ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.

```javascript
import { ApolloClient, InMemoryCache, ApolloProvider, useSubscription, gql } from '@apollo/client';

const client = new ApolloClient({
  uri: 'http://localhost:4000/graphql',
  cache: new InMemoryCache(),
});

const SUBSCRIBE_MESSAGES = gql`
  subscription {
    messageSent
  }
`;

function MessageComponent() {
  const { data } = useSubscription(SUBSCRIBE_MESSAGES);

  if (data) {
    // λ°μ΄ν„° μ²λ¦¬ λ΅μ§ μ‘μ„±
  }

  return (
    // μ»΄ν¬λ„νΈ λ λ”λ§ λ΅μ§ μ‘μ„±
  );
}

function App() {
  return (
    <ApolloProvider client={client}>
      <MessageComponent />
    </ApolloProvider>
  );
}
```

μ„μ μμ λ” Apollo Clientλ¥Ό μ‚¬μ©ν•μ—¬ `messageSent` κµ¬λ…μ„ μν–‰ν•λ” ν΄λΌμ΄μ–ΈνΈ μ½”λ“μ…λ‹λ‹¤.

## κ²°λ΅ 

μλ°”μ¤ν¬λ¦½νΈλ¥Ό ν™μ©ν• GraphQL Subscriptionsλ¥Ό λ°°ν¬ν•κΈ° μ„ν•΄μ„λ” ν™κ²½ μ„¤μ •, μ‹¤μ‹κ°„ λ°μ΄ν„° ν‘Έμ‹, λ°°ν¬ μ „λµμ΄ ν•„μ”ν•©λ‹λ‹¤. μ„μ λ‹¨κ³„λ¥Ό λ”°λΌκ°€λ©΄ GraphQL Subscriptionsλ¥Ό μ›ν™ν•κ² κ°λ°ν•κ³  λ°°ν¬ν•  μ μμµλ‹λ‹¤. μμ„Έν• λ‚΄μ©μ€ κ³µμ‹ λ¬Έμ„ λ° μ¨λΌμΈ μλ£λ¥Ό μ°Έμ΅°ν•μ‹κΈ° λ°”λλ‹λ‹¤.

#GraphQL #Subscriptions