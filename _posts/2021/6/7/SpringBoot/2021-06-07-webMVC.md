---
layout: post
title: "[SpringBoot] Web MVC ë§Œë“¤ê¸°"
description: " "
date: 2021-06-07
tags: [spring]
comments: true
share: true
---

## ğŸ‹ï¸â€â™€ï¸ Web MVC ë§Œë“¤ê¸°

[ëª©í‘œ]

- ìŠ¤í”„ë§ ë¶€íŠ¸ë¡œ ê°„ë‹¨í•œ Restful Web ê²½ë¡œë¥¼ ì„¤ì •í•˜ê¸°
- JSON í˜¹ì€ XMLë¡œ ë°ì´í„° ì—°ê²°í•˜ê¸°

### Spring Boot ìŠ¤í”„ë§ë¶€íŠ¸ Web MVC

> - **ê°œë°œìê°€ í•˜ì§€ ì•Šì•„ë„ ìë™ìœ¼ë¡œ Spring MVC ì„¤ì •ì„ í•´ì¤Œ**
>   spring-boot-autoconfigure.jar / META-INF ë””ë ‰í† ë¦¬ ë‚´ì— spring.factoriesì˜ org.springframework.boot.autoconfigure.web.servlet.**WebMvcAutoConfiguration**ì—ì„œ WebMvcì™€ ê´€ë ¨ëœ í´ë˜ìŠ¤ê°€ ìë™ ì„¤ì •
> - **ìŠ¤í”„ë§ MVC í™•ì¥ ì œê³µ**
>   @Configuration + WebMvcConfigurer ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„

<br> <br>

### Restful Web êµ¬ì¶•í•˜ê¸°

#### 1. User í´ë˜ìŠ¤ ìƒì„± / Entityë¡œ ë“±ë¡

[User.java]

```java
@Entity
public class User {
	@Id @GeneratedValue(strategy = GenerationType.IDENTITY)
	private Long id;

	@Column
	private String name;

	@Column(unique=true)
	private String email;


	public Long getId() {
		return id;
	}

	public void setId(Long id) {
		this.id = id;
	}

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}

	public String getEmail() {
		return email;
	}

	public void setEmail(String email) {
		this.email = email;
	}
}
```

<br>

#### 2. Repository ë“±ë¡

[UserRepository.java]

```java
public interface UserRepository extends JpaRepository<User, Long> {
	Optional<User> findByEmail(String email);
}
```

<br>

#### 3. RestControllerì‘ì„± (JSON)

[ ì–´ë…¸í…Œì´ì…˜ì„ í†µí•œ HTTP ë©”ì„¸ì§€ì™€ ê°ì²´ ë§¤í•‘]

[ ğŸ”– Restful ì–´ë…¸í…Œì´ì…˜ ë³´ê¸°](./Spring/spring_mvc.md)

**@RequestBody**

- JsonMessageConverter
- HTTP ìš”ì²­ ë³¸ë¬¸ì„ Jsonê°ì²´ë¡œ ë³€ê²½í•˜ê±°ë‚˜, Jsonê°ì²´ë¥¼ HTTP ì‘ë‹µ ë³¸ë¬¸ìœ¼ë¡œ ë³€ê²½í•  ë•ŒëŠ” JsonMessageConverter ì‚¬ìš©
- {"username":"vega2k", "password":"123"} <-> User
- Controllerì—ì„œ ContentNegotiatingViewResolverë¥¼ í†µí•´ ê°ì²´ë¥¼ ìë™ì ìœ¼ë¡œ json í˜•ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë°˜í™˜

<br>

**@ResponseEntity**

- ëª¨ë“  HTTP responseë¥¼ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆëŠ” ê°ì²´ (status code, headers, body)
- ì•¤ë“œí¬ì¸íŠ¸ì— ê²°ê³¼ê°’ì„ ë³´ì—¬ì¤Œ (ë‚˜ë¨¸ì§€ëŠ” ìŠ¤í”„ë§ì´ ì²˜ë¦¬)
- Generic Typeì´ë¼ ì–´ë–¤ íƒ€ì…ì´ë˜ ë¦¬í„´ ê°€ëŠ¥
- ì°¸ì¡° https://www.baeldung.com/spring-response-entity

<br>

```java
@RestController
public class UserRestController {

	@Autowired
	private UserRepository userRepo;

    // ìœ ì € ìƒì„±
	@PostMapping("/users")
	public User create(@RequestBody User user) {
		return userRepo.save(user);
	}

    // ìœ ì € ì¡°íšŒ
	@RequestMapping(value = "/users/{id}")
	public User getUser(@PathVariable Long id) {
		Optional<User> optional = userRepo.findById(id);
		return optional.orElseThrow(() -> new ResourceNotFoundException("User", "id", id));
	}

    // ì „ì²´ ìœ ì € ì¡°íšŒ
	@RequestMapping(value = "/users", produces = { "application/json" })
	public List<User> getUsers() {
		return userRepo.findAll();
	}

    // ìœ ì € ì‚­ì œ
	@DeleteMapping("/users/{id}")
	public ResponseEntity<?> deleteUser(@PathVariable Long id) {

	Optional<User> optional = userRepo.findById(id);
	    //IDì™€ ë§¤í•‘í•˜ëŠ” ìœ ì €ê°€ ì—†ëŠ” ê²½ìš°
	    if(optional.isEmpty()) {
		return new ResponseEntity<>("ìš”ì²­í•œ ID ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ",HttpStatus.NOT_FOUND);
	    }

	    //ì‹¤ì œ DBì‚­ì œ
	    userRepo.deleteById(id);
	    return new ResponseEntity<>(id+ "ì‚­ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ", HttpStatus.OK);
	}

    // ìœ ì € ì •ë³´ ë³€ê²½
	@PutMapping("/users/{id}")
	public User updateUser(@PathVariable Long id, @RequestBody User userDetail) {
		User user = userRepo.findById(id).orElseThrow(() -> new ResourceNotFoundException("User", "id", id));
		user.setName(userDetail.getName());
		user.setEmail(userDetail.getEmail());
		User updatedUser = userRepo.save(user);
		return updatedUser;
	}
}
```

<br>

#### 4. ì‚¬ìš©ì ì •ì˜ Exception ë§Œë“¤ê¸° : ResoueceNotFoundException

<br>

[ ResourceNotFoundException.java]

```java
@ResponseStatus(value= HttpStatus.NOT_FOUND)
public class ResourceNotFoundException extends RuntimeException{

	private String resourceName;
	private String fieldName;
	private Object fieldvalue;

	public ResourceNotFoundException(String resourceName, String fieldName, Object fieldvalue) {
		super(String.format("%s not found with %s : '%s'", resourceName, fieldName, fieldvalue));
		this.resourceName = resourceName;
		this.fieldName = fieldName;
		this.fieldvalue = fieldvalue;
	}

	public String getResourceName() {
		return resourceName;
	}

	public String getFieldName() {
		return fieldName;
	}

	public Object getFieldvalue() {
		return fieldvalue;
	}
```

<br><br>

### Postmanìœ¼ë¡œ json ë°ì´í„° ë‹¤ë£¨ê¸°

#### >> postman ì ‘ì†

https://www.postman.com/

<br>

**[1. ì¸ë±ìŠ¤ í˜ì´ì§€ Getìœ¼ë¡œ ì—°ê²° í™•ì¸]**

![](./imgs/bootMVC/postman1.png)

<br>

**[2. Postë¡œ localhost:8086/usersì—ì„œ user ë„£ê¸°]**

> 1. ìº¡ì²˜ì—ëŠ” urlì´ users/1ë¡œ ë˜ì–´ìˆì§€ë§Œ contoller.javaì—ì„œ ì„¤ì •í•œ ëŒ€ë¡œ /usersë¡œë§Œ ì ‘ì†í•´ì•¼ í¬ìŠ¤íŠ¸ ë¨

![](./imgs/bootMVC/postman2.png)

<br>

> 2. ì‚½ì…í•  JSON ë°ì´í„° ë„£ì–´ì£¼ê¸°

![](./imgs/bootMVC/postman3.png)

<br>

**[3. ì „ì²´ ìœ ì € ë°›ì•„ì˜¤ê¸°]**

![](./imgs/bootMVC/postman4.png)

<br>

**[4. users/idê°’ìœ¼ë¡œ connectí•´ì„œ ì„¤ì • ê°’ ë³€ê²½í•´ì£¼ê¸°]**

![](./imgs/bootMVC/postman5.png)

<br>

**[5.Deleteë¡œ ìœ ì € ì‚­ì œí•˜ê¸°]**

> 1. users/ì‚­ì œí•  ìœ ì € idë¡œ ì‚­ì œ

![](./imgs/bootMVC/postman_del1.png)

![](./imgs/bootMVC/postman_del2.png)

> 2.  ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìœ ì €idë¡œ delete ìš”ì²­ í•  ê²½ìš°

![](./imgs/bootMVC/postman_del3.png)

> 3. ë‹¤ì‹œ ì „ì²´ ìœ ì € ì¡°íšŒ

![](./imgs/bootMVC/postman_del4.png)

<br>
<br>

#### 3-1. RestController ë³€ê²½ (XML)

> - Jsonìœ¼ë¡œ ì„¤ì •í–ˆë˜ getUsersë¥¼ XMLë¡œ ì„¤ì • í•´ë³´ê¸°
> - **produces = { "application/xml" }**
> - produces ì„¤ì • ì•ˆí•˜ë©´ ê¸°ë³¸ json
> - xml converter ì˜ì¡´ì„± ì¶”ê°€í•´ì¤˜ì•¼í•¨

```java
@RequestMapping(value = "/usersXml", produces = { "application/xml" })
public List<User> getUsersXml() {
	return userRepo.findAll();
}
```

[pom.xml]

```xml
<!-- xml converter -->
<dependency>
	<groupId>com.fasterxml.jackson.dataformat</groupId>
	<artifactId>jackson-dataformat-xml</artifactId>
	<version>2.9.6</version>
</dependency>
```

<br>

#### Postmanì—ì„œ í™•ì¸í•˜ê¸°

[ /users ë¶ˆëŸ¬ì˜¤ê¸°] : jsoní˜•íƒœì—ì„œ htmlë¡œ ë°”ë€œ

![](./imgs/bootMVC/xml1.png)

<br>

[User.java] : @JacksonXmlPropertyë¡œ attribute ì§€ì •ì„ í•´ì¤Œ

![](./imgs/bootMVC/xml3.png)

[postman] : idê°€ ì†ì„±ê°’ìœ¼ë¡œ ë°”ë€œ

![](./imgs/bootMVC/xml2.png)

<br>

[entity/Users.java ì¶”ê°€] : `<item></item>`ì„ `<User></User>`ê°ì²´ë¡œ

![](./imgs/bootMVC/xml6.png)

[RestControllerì˜ getUsersë¥¼ ë³€ê²½]

```java
@RequestMapping(value = "/usersXml", produces = { "application/xml" })
public Users getUserxml() {
	Users userXml = new Users();
	userXml.setUsers(userRepo.findAll());
	return userXml;
}
```

[postman ë³€ê²½ ê°’ í™•ì¸]
![](./imgs/bootMVC/xml4.png)

<br>

[Users.java]

- Usersì˜ @JacksonXmlElementWrapper(useWrapping = false)ë¥¼ ì£¼ì„ì²˜ë¦¬ í•  ê²½ìš°

```java
@JacksonXmlRootElement
public class Users implements Serializable {
	private static final long serialVersionUID = 22L;
	@JacksonXmlProperty(localName = "User")
	// @JacksonXmlElementWrapper(useWrapping = false)
	private List<User> users = new ArrayList<>();

	public void setUsers(List<User> users) {
		this.users = users;
	}

	public List<User> getUsers() {
		return users;
	}
}
```

[postman] : `<Users>`ì•ˆì— `<User></User>`ë¡œ í•œ ë²ˆ ë” ê°ì‹¸ì§
![](./imgs/bootMVC/xml5.png)

<br>
<br>
<br>
